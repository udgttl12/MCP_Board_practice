<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP ê²Œì‹œíŒ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ MCP ê²Œì‹œíŒ</h1>
            <p class="subtitle">Model Context Protocolì„ í™œìš©í•œ ìë™ ì°¨íŠ¸ ìƒì„± ê²Œì‹œíŒ</p>
        </header>
        
        <!-- ê²Œì‹œê¸€ ì‘ì„± í¼ -->
        <section class="post-form">
            <h2>ğŸ“ ê²Œì‹œê¸€ ì‘ì„±</h2>
            <form id="postForm">
                <div class="form-group">
                    <label for="author">ì‘ì„±ìëª… *</label>
                    <input type="text" id="author" placeholder="ì‘ì„±ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div class="form-group">
                    <label for="title">ì œëª© *</label>
                    <input type="text" id="title" placeholder="ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div class="form-group">
                    <label for="content">ë‚´ìš©</label>
                    <textarea id="content" placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="numericValue">ìˆ«ìê°’ (ì°¨íŠ¸ìš©)</label>
                        <input type="number" id="numericValue" placeholder="ì°¨íŠ¸ì— í‘œì‹œí•  ìˆ«ìê°’" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="category">ì¹´í…Œê³ ë¦¬</label>
                        <select id="category">
                            <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                            <option value="ë§¤ì¶œ">ë§¤ì¶œ</option>
                            <option value="ì‚¬ìš©ì">ì‚¬ìš©ì</option>
                            <option value="ì„±ëŠ¥">ì„±ëŠ¥</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">ê²Œì‹œê¸€ ì‘ì„±</button>
            </form>
        </section>
        
        <!-- MCP ìƒíƒœ ë° API í‚¤ ì„¤ì • -->
        <section class="mcp-status" id="mcpStatusSection">
            <h2>ğŸ¤– MCP ìƒíƒœ</h2>
            <div id="mcpStatus" class="status-display">
                <p>ğŸ”„ MCP ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</p>
            </div>
            
            <div id="apiKeySection" class="api-key-setup" style="display: none;">
                <h3>ğŸ”‘ Anthropic API í‚¤ ì„¤ì •</h3>
                <div class="api-key-info">
                    <p><strong>ì‹¤ì œ MCPë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤:</strong></p>
                    <ol>
                        <li><a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a>ì—ì„œ ê³„ì • ìƒì„±</li>
                        <li>API í‚¤ ë°œê¸‰ (Credits êµ¬ë§¤ í•„ìš”)</li>
                        <li>ì•„ë˜ì— API í‚¤ ì…ë ¥</li>
                    </ol>
                </div>
                
                <div class="api-key-input">
                    <input type="password" id="anthropicApiKey" placeholder="sk-ant-api03-..." size="50">
                    <button onclick="setApiKey()" class="btn btn-primary">API í‚¤ ì„¤ì •</button>
                </div>
                
                <div class="api-key-note">
                    <p><small>âš ï¸ API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ì„œë²„ ì¬ì‹œì‘ ì‹œ ë‹¤ì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.</small></p>
                </div>
            </div>
        </section>

        <!-- MCP í†µì‹  ë¡œê·¸ -->
        <section class="mcp-logs">
            <div class="logs-header">
                <h2>ğŸ“Š MCP í†µì‹  ë¡œê·¸</h2>
                <div class="logs-controls">
                    <button onclick="loadMcpLogs()" class="btn btn-secondary">ìƒˆë¡œê³ ì¹¨</button>
                    <button onclick="clearMcpLogs()" class="btn btn-warning">ë¡œê·¸ ì´ˆê¸°í™”</button>
                    <label class="auto-refresh-label">
                        <input type="checkbox" id="autoRefreshLogs" onchange="toggleAutoRefresh()">
                        ìë™ ìƒˆë¡œê³ ì¹¨ (5ì´ˆ)
                    </label>
                </div>
            </div>
            
            <div class="logs-container" id="mcpLogsContainer">
                <div class="loading-message">ğŸ”„ ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </section>

        <!-- MCP ê²Œì‹œê¸€ ê´€ë¦¬ ì„¹ì…˜ -->
        <section class="post-management-section">
            <h2>ğŸ¤– MCP ê²Œì‹œê¸€ ê´€ë¦¬</h2>
            <div class="management-info">
                <p><strong>ìì—°ì–´ë¡œ ê²Œì‹œê¸€ì„ ê´€ë¦¬í•˜ì„¸ìš”!</strong> AIê°€ ëª…ë ¹ì„ ì´í•´í•˜ê³  ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
            </div>
            
            <!-- ëª…ë ¹ì–´ ë„ì›€ë§ -->
            <div class="post-command-help">
                <h3>ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´</h3>
                <div class="command-examples">
                    <div class="example-section">
                        <h6>ğŸ“ ê²Œì‹œê¸€ ì‘ì„±</h6>
                        <ul>
                            <li>"í™ê¸¸ë™ìœ¼ë¡œ ìƒˆ ê²Œì‹œê¸€ ì‘ì„±í•´ì¤˜. ì œëª©ì€ '4ì›” ë§¤ì¶œ', ë‚´ìš©ì€ 'ì¦ê°€í–ˆìŠµë‹ˆë‹¤', ìˆ˜ì¹˜ê°’ì€ 250.5"</li>
                            <li>"ê¹€ì² ìˆ˜ ê²Œì‹œê¸€ ì¶”ê°€. ì œëª© 'ì‚¬ìš©ì ì¦ê°€', ë‚´ìš© 'ì¢‹ì€ ì„±ê³¼'"</li>
                        </ul>
                    </div>
                    <div class="example-section">
                        <h6>âœï¸ ê²Œì‹œê¸€ ìˆ˜ì •</h6>
                        <ul>
                            <li>"1ë²ˆ ê²Œì‹œê¸€ ì œëª©ì„ 'ìƒˆë¡œìš´ ì œëª©'ìœ¼ë¡œ ë°”ê¿”ì¤˜"</li>
                            <li>"2ë²ˆ ê²Œì‹œê¸€ ë‚´ìš©ì„ 'ìˆ˜ì •ëœ ë‚´ìš©ì…ë‹ˆë‹¤'ë¡œ ìˆ˜ì •í•´ì¤˜"</li>
                            <li>"3ë²ˆ ê²Œì‹œê¸€ ì‘ì„±ìë¥¼ 'ì´ì˜í¬'ë¡œ ë³€ê²½í•´ì¤˜"</li>
                        </ul>
                    </div>
                    <div class="example-section">
                        <h6>ğŸ—‘ï¸ ê²Œì‹œê¸€ ì‚­ì œ</h6>
                        <ul>
                            <li>"1ë²ˆ ê²Œì‹œê¸€ ì‚­ì œí•´ì¤˜"</li>
                            <li>"í™ê¸¸ë™ì˜ ëª¨ë“  ê²Œì‹œê¸€ ì‚­ì œí•´ì¤˜"</li>
                        </ul>
                    </div>
                    <div class="example-section">
                        <h6>ğŸ“‹ ê²Œì‹œê¸€ ì¡°íšŒ</h6>
                        <ul>
                            <li>"ê²Œì‹œê¸€ ëª©ë¡ ë³´ì—¬ì¤˜"</li>
                            <li>"í™ê¸¸ë™ì˜ ê²Œì‹œê¸€ ë³´ì—¬ì¤˜"</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="command-input">
                <input type="text" id="postCommand" placeholder="ì˜ˆ: í™ê¸¸ë™ìœ¼ë¡œ ìƒˆ ê²Œì‹œê¸€ ì‘ì„±í•´ì¤˜. ì œëª©ì€ '4ì›” ë§¤ì¶œ', ë‚´ìš©ì€ 'ì¦ê°€í–ˆìŠµë‹ˆë‹¤'" size="60">
                <button onclick="executePostCommand()" class="btn btn-post">ğŸš€ ì‹¤í–‰</button>
            </div>
            
            <!-- ì‹¤í–‰ ê²°ê³¼ -->
            <div id="postResult" class="result-container" style="display: none;">
                <h3>ğŸ“„ ì‹¤í–‰ ê²°ê³¼</h3>
                <div id="postResultContent"></div>
            </div>
        </section>

        <!-- ì°¨íŠ¸ ìƒì„± ëª…ë ¹ -->
        <section class="chart-command">
            <h2>ğŸ“Š ì°¨íŠ¸ ìƒì„±</h2>
            <div class="command-help">
                <p><strong>ì‚¬ìš© ì˜ˆì‹œ:</strong></p>
                <div class="command-examples">
                    <div class="example-section">
                        <h6>ğŸ“Š ë‹¨ì¼ ì‘ì„±ì ì°¨íŠ¸</h6>
                        <ul>
                            <li>"í™ê¸¸ë™ì˜ ë°ì´í„°ë¥¼ ë§‰ëŒ€ì°¨íŠ¸ë¡œ ë³´ì—¬ì¤˜"</li>
                            <li>"ê¹€ì² ìˆ˜ì˜ ê°’ì„ ì„ ê·¸ë˜í”„ë¡œ í‘œì‹œí•´ì¤˜"</li>
                            <li>"ì´ì˜í¬ì˜ ìˆ˜ì¹˜ë¥¼ ì›ê·¸ë˜í”„ë¡œ ë§Œë“¤ì–´ì¤˜"</li>
                        </ul>
                    </div>
                    <div class="example-section">
                        <h6>ğŸ‘¥ ë‹¤ì¤‘ ì‘ì„±ì ì°¨íŠ¸ (NEW!)</h6>
                        <ul>
                            <li>"í™ê¸¸ë™ê³¼ ê¹€ì² ìˆ˜ì˜ ë°ì´í„°ë¥¼ ì›ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤˜"</li>
                            <li>"í™ê¸¸ë™, ê¹€ì² ìˆ˜ì˜ ê°’ì„ ë§‰ëŒ€ì°¨íŠ¸ë¡œ ë¹„êµí•´ì¤˜"</li>
                            <li>"í™ê¸¸ë™ ê¹€ì² ìˆ˜ ë°ì´í„°ë¥¼ ì„ ê·¸ë˜í”„ë¡œ ë§Œë“¤ì–´ì¤˜"</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="command-input">
                <input type="text" id="command" placeholder="ì˜ˆ: í™ê¸¸ë™ì˜ ë°ì´í„°ë¥¼ ë§‰ëŒ€ì°¨íŠ¸ë¡œ ë³´ì—¬ì¤˜" size="50">
                <button onclick="executeCommand()" class="btn btn-chart">ì°¨íŠ¸ ìƒì„±</button>
            </div>
            
            {% if available_authors %}
            <div class="available-authors">
                <p><strong>ì‚¬ìš© ê°€ëŠ¥í•œ ì‘ì„±ì:</strong> 
                    {% for author in available_authors %}
                        <span class="author-tag" onclick="fillAuthor('{{ author }}')">{{ author }}</span>
                        {% if not loop.last %}, {% endif %}
                    {% endfor %}
                </p>
            </div>
            {% endif %}
        </section>
        
        <!-- ê²°ê³¼ ë©”ì‹œì§€ -->
        <div id="message" class="message"></div>
        
        <!-- ì°¨íŠ¸ í‘œì‹œ ì˜ì—­ -->
        <section class="chart-container">
            <h3>ğŸ“ˆ ìƒì„±ëœ ì°¨íŠ¸</h3>
            <div class="chart-wrapper">
                <canvas id="dynamicChart" width="400" height="200"></canvas>
                <div id="chartPlaceholder" class="chart-placeholder">
                    ì°¨íŠ¸ë¥¼ ìƒì„±í•˜ë ¤ë©´ ìœ„ì˜ ëª…ë ¹ì–´ ì…ë ¥ë€ì— ëª…ë ¹ì„ ì…ë ¥í•˜ì„¸ìš”.
                </div>
            </div>
            <div id="chartSummary" class="chart-summary"></div>
        </section>
        
        <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
        <section class="post-list">
            <h2>ğŸ“„ ìµœê·¼ ê²Œì‹œê¸€</h2>
            <div class="posts-header">
                <button onclick="loadAllPosts()" class="btn btn-secondary">ì „ì²´ ê²Œì‹œê¸€ ë³´ê¸°</button>
                <button onclick="loadPosts()" class="btn btn-secondary">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div id="posts" class="posts-grid">
                {% if posts %}
                    {% for post in posts %}
                    <div class="post-card" data-author="{{ post.author }}">
                        <div class="post-header">
                            <h4>{{ post.title }}</h4>
                            <span class="post-author">{{ post.author }}</span>
                        </div>
                        <div class="post-content">
                            {% if post.content %}
                                <p>{{ post.content[:100] }}{% if post.content|length > 100 %}...{% endif %}</p>
                            {% endif %}
                            {% if post.numeric_value %}
                                <div class="numeric-value">
                                    <span class="value-label">ìˆ˜ì¹˜ê°’:</span>
                                    <span class="value">{{ post.numeric_value }}</span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="post-footer">
                            {% if post.category %}
                                <span class="category">{{ post.category }}</span>
                            {% endif %}
                            <span class="post-date">{{ post.created_at[:19] if post.created_at else '' }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="no-posts">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endif %}
            </div>
        </section>
        
        <!-- ë„ì›€ë§ ì„¹ì…˜ -->
        <section class="help-section">
            <h2>â“ ì‚¬ìš© ë°©ë²•</h2>
            <div class="help-cards">
                <div class="help-card">
                    <h4>1. ê²Œì‹œê¸€ ì‘ì„±</h4>
                    <p>ì‘ì„±ìëª…, ì œëª©ê³¼ í•¨ê»˜ ì°¨íŠ¸ì— í‘œì‹œí•  ìˆ«ìê°’ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
                </div>
                <div class="help-card">
                    <h4>2. ì°¨íŠ¸ ìƒì„± ëª…ë ¹</h4>
                    <p>ìì—°ì–´ë¡œ "ì‘ì„±ìì˜ ë°ì´í„°ë¥¼ ì°¨íŠ¸íƒ€ì…ìœ¼ë¡œ ë³´ì—¬ì¤˜" í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.</p>
                </div>
                <div class="help-card">
                    <h4>3. ì§€ì›í•˜ëŠ” ì°¨íŠ¸</h4>
                    <p>ë§‰ëŒ€ì°¨íŠ¸, ì„ ê·¸ë˜í”„, ì›ê·¸ë˜í”„, ë„ë„›ì°¨íŠ¸ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
                </section>
    </div>

    <!-- ê²Œì‹œê¸€ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“ ê²Œì‹œê¸€ ìˆ˜ì •</h3>
                <span class="modal-close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label for="editAuthor">ì‘ì„±ì:</label>
                    <input type="text" id="editAuthor" required>
                </div>
                <div class="form-group">
                    <label for="editTitle">ì œëª©:</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-group">
                    <label for="editContent">ë‚´ìš©:</label>
                    <textarea id="editContent" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label for="editNumericValue">ìˆ˜ì¹˜ê°’ (ì„ íƒì‚¬í•­):</label>
                    <input type="number" id="editNumericValue" step="0.1">
                </div>
                <div class="form-group">
                    <label for="editCategory">ì¹´í…Œê³ ë¦¬ (ì„ íƒì‚¬í•­):</label>
                    <input type="text" id="editCategory">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ìˆ˜ì • ì™„ë£Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentChart = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadPosts();
            checkMcpStatus();
            loadMcpLogs(); // Load initial logs
            
            // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('postForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addPost();
            });
            
            // ì—”í„° í‚¤ë¡œ ëª…ë ¹ ì‹¤í–‰
            document.getElementById('command').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    executeCommand();
                }
            });
        });
        
        // ì°¨íŠ¸ ìƒì„± ëª…ë ¹ ì‹¤í–‰
        async function executeCommand() {
            const command = document.getElementById('command').value.trim();
            
            if (!command) {
                showMessage('ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            showMessage('ì°¨íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            hideChartPlaceholder();
            
            try {
                const response = await fetch('/generate-chart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({command: command})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
                    if (currentChart) {
                        currentChart.destroy();
                    }
                    
                    // MCPì—ì„œ ìƒì„±ëœ Chart.js ì½”ë“œ ì‹¤í–‰
                    eval(result.chart_code);
                    currentChart = window.myChart;
                    
                    // ì°¨íŠ¸ ìš”ì•½ ì •ë³´ í‘œì‹œ
                    displayChartSummary(result.summary);
                    
                    showMessage(result.message, 'success');
                } else {
                    showMessage(result.message, 'error');
                    showChartPlaceholder();
                }
                
            } catch (error) {
                showMessage('ì°¨íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                showChartPlaceholder();
            }
        }
        
        // ê²Œì‹œê¸€ ì¶”ê°€
        async function addPost() {
            const formData = {
                author: document.getElementById('author').value.trim(),
                title: document.getElementById('title').value.trim(),
                content: document.getElementById('content').value.trim(),
                numeric_value: parseFloat(document.getElementById('numericValue').value) || null,
                category: document.getElementById('category').value || null
            };
            
            if (!formData.author || !formData.title) {
                showMessage('ì‘ì„±ìì™€ ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/add-post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('postForm').reset();
                    
                    // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadPosts();
                } else {
                    showMessage(result.message, 'error');
                }
                
            } catch (error) {
                showMessage('ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }
        
        // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
        async function loadPosts() {
            try {
                const response = await fetch('/posts');
                const result = await response.json();
                
                if (result.success) {
                    displayPosts(result.posts.slice(0, 10)); // ìµœê·¼ 10ê°œë§Œ í‘œì‹œ
                } else {
                    console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', result.message);
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì „ì²´ ê²Œì‹œê¸€ ë¡œë“œ
        async function loadAllPosts() {
            try {
                const response = await fetch('/posts');
                const result = await response.json();
                
                if (result.success) {
                    displayPosts(result.posts);
                }
            } catch (error) {
                console.error('ì „ì²´ ê²Œì‹œê¸€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ê²Œì‹œê¸€ í‘œì‹œ
        function displayPosts(posts) {
            const postsContainer = document.getElementById('posts');
            
            if (!posts || posts.length === 0) {
                postsContainer.innerHTML = '<p class="no-posts">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const postsHTML = posts.map(post => `
                <div class="post-card" data-author="${post.author}">
                    <div class="post-header">
                        <h4>${escapeHtml(post.title)}</h4>
                        <span class="post-author">${escapeHtml(post.author)}</span>
                    </div>
                    <div class="post-content">
                        ${post.content ? `<p>${escapeHtml(post.content.substring(0, 100))}${post.content.length > 100 ? '...' : ''}</p>` : ''}
                        ${post.numeric_value ? `
                            <div class="numeric-value">
                                <span class="value-label">ìˆ˜ì¹˜ê°’:</span>
                                <span class="value">${post.numeric_value}</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="post-footer">
                        <div class="post-meta">
                            ${post.category ? `<span class="category">${escapeHtml(post.category)}</span>` : ''}
                            <span class="post-date">${post.created_at ? post.created_at.substring(0, 19) : ''}</span>
                        </div>
                        <div class="post-actions">
                            <button class="btn btn-edit" onclick="openEditModal(${post.id}, '${escapeHtml(post.title).replace(/'/g, '\\\'').replace(/"/g, '&quot;')}', '${escapeHtml(post.content || '').replace(/'/g, '\\\'').replace(/"/g, '&quot;')}', '${escapeHtml(post.author)}', ${post.numeric_value || 'null'}, '${escapeHtml(post.category || '')}')">âœï¸ ìˆ˜ì •</button>
                            <button class="btn btn-delete" onclick="deletePost(${post.id}, '${escapeHtml(post.title)}')">ğŸ—‘ï¸ ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            postsContainer.innerHTML = postsHTML;
        }
        
        // ì°¨íŠ¸ ìš”ì•½ ì •ë³´ í‘œì‹œ
        function displayChartSummary(summary) {
            if (!summary) return;
            
            let summaryHTML = '';
            
            // ë‹¤ì¤‘ ì‘ì„±ì ì°¨íŠ¸ì¸ì§€ í™•ì¸
            if (summary.authors && summary.authors.length > 1) {
                // ë‹¤ì¤‘ ì‘ì„±ì ìš”ì•½
                summaryHTML = `
                    <div class="summary-info">
                        <h4>ë‹¤ì¤‘ ì‘ì„±ì ë°ì´í„° ìš”ì•½</h4>
                        <div class="multi-author-summary">
                            <div class="overall-stats">
                                <h5>ì „ì²´ í†µê³„</h5>
                                <div class="summary-stats">
                                    <span class="stat">ì´ ì‘ì„±ì: ${summary.total_authors}ëª…</span>
                                    <span class="stat">ì´ ê²Œì‹œê¸€: ${summary.total_posts}ê°œ</span>
                                    <span class="stat">ì „ì²´ í•©ê³„: ${summary.total_value}</span>
                                    <span class="stat">ì „ì²´ í‰ê· : ${summary.average_value}</span>
                                </div>
                            </div>
                            <div class="author-breakdown">
                                <h5>ì‘ì„±ìë³„ ìƒì„¸</h5>
                                ${Object.entries(summary.author_breakdown || {}).map(([author, stats]) => `
                                    <div class="author-stats">
                                        <strong>${escapeHtml(author)}</strong>
                                        <div class="summary-stats">
                                            <span class="stat">ê²Œì‹œê¸€: ${stats.posts}ê°œ</span>
                                            <span class="stat">ì´í•©: ${stats.total_value}</span>
                                            <span class="stat">í‰ê· : ${stats.average_value}</span>
                                            <span class="stat">ìµœëŒ€: ${stats.max_value}</span>
                                            <span class="stat">ìµœì†Œ: ${stats.min_value}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // ë‹¨ì¼ ì‘ì„±ì ìš”ì•½ (ê¸°ì¡´ ë°©ì‹)
                const authorName = summary.author || (summary.authors && summary.authors[0]) || 'ì‘ì„±ì';
                summaryHTML = `
                    <div class="summary-info">
                        <h4>${escapeHtml(authorName)}ë‹˜ì˜ ë°ì´í„° ìš”ì•½</h4>
                        <div class="summary-stats">
                            <span class="stat">ì´ ê²Œì‹œê¸€: ${summary.total_posts}ê°œ</span>
                            <span class="stat">í‰ê· ê°’: ${summary.average_value}</span>
                            <span class="stat">ìµœëŒ€ê°’: ${summary.max_value}</span>
                            <span class="stat">ìµœì†Œê°’: ${summary.min_value}</span>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('chartSummary').innerHTML = summaryHTML;
        }
        
        // ì‘ì„±ìëª… ìë™ ì…ë ¥
        function fillAuthor(authorName) {
            const commandInput = document.getElementById('command');
            commandInput.value = `${authorName}ì˜ ë°ì´í„°ë¥¼ ë§‰ëŒ€ì°¨íŠ¸ë¡œ ë³´ì—¬ì¤˜`;
            commandInput.focus();
        }
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';
            
            // 3ì´ˆ í›„ ë©”ì‹œì§€ ìë™ ì œê±°
            setTimeout(() => {
                messageDiv.style.display = 'none';
                messageDiv.textContent = '';
                messageDiv.className = 'message';
            }, 3000);
        }
        
        // ì°¨íŠ¸ í”Œë ˆì´ìŠ¤í™€ë” ê´€ë¦¬
        function hideChartPlaceholder() {
            const placeholder = document.getElementById('chartPlaceholder');
            const canvas = document.getElementById('dynamicChart');
            placeholder.style.display = 'none';
            canvas.style.display = 'block';
        }
        
        function showChartPlaceholder() {
            const placeholder = document.getElementById('chartPlaceholder');
            const canvas = document.getElementById('dynamicChart');
            placeholder.style.display = 'flex';
            canvas.style.display = 'none';
        }
        
        // MCP ìƒíƒœ í™•ì¸
        async function checkMcpStatus() {
            try {
                const response = await fetch('/mcp-status');
                const result = await response.json();
                
                if (result.success) {
                    displayMcpStatus(result.mcp_status);
                } else {
                    displayMcpStatus({
                        mode: "ì˜¤ë¥˜",
                        api_key_configured: false,
                        mcp_available: false
                    });
                }
            } catch (error) {
                console.error('MCP ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                displayMcpStatus({
                    mode: "ì—°ê²° ì˜¤ë¥˜",
                    api_key_configured: false,
                    mcp_available: false
                });
            }
        }
        
        // MCP ìƒíƒœ í‘œì‹œ
        function displayMcpStatus(status) {
            const statusDiv = document.getElementById('mcpStatus');
            const apiKeySection = document.getElementById('apiKeySection');
            
            let statusHTML = `
                <div class="status-item">
                    <span class="status-label">ëª¨ë“œ:</span>
                    <span class="status-value ${status.mcp_available ? 'status-success' : 'status-warning'}">${status.mode}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">API í‚¤:</span>
                    <span class="status-value ${status.api_key_configured ? 'status-success' : 'status-error'}">
                        ${status.api_key_configured ? 'âœ… ì„¤ì •ë¨' : 'âŒ ë¯¸ì„¤ì •'}
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">MCP ì‚¬ìš© ê°€ëŠ¥:</span>
                    <span class="status-value ${status.mcp_available ? 'status-success' : 'status-error'}">
                        ${status.mcp_available ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}
                    </span>
                </div>
            `;
            
            if (status.model) {
                statusHTML += `
                    <div class="status-item">
                        <span class="status-label">ëª¨ë¸:</span>
                        <span class="status-value">${status.model}</span>
                    </div>
                `;
            }
            
            if (status.api_test) {
                statusHTML += `
                    <div class="status-item">
                        <span class="status-label">API í…ŒìŠ¤íŠ¸:</span>
                        <span class="status-value">${status.api_test}</span>
                    </div>
                `;
            }
            
            statusDiv.innerHTML = statusHTML;
            
            // API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì„¤ì • ì„¹ì…˜ í‘œì‹œ
            if (!status.api_key_configured) {
                apiKeySection.style.display = 'block';
            } else {
                apiKeySection.style.display = 'none';
            }
        }
        
        // API í‚¤ ì„¤ì •
        async function setApiKey() {
            const apiKey = document.getElementById('anthropicApiKey').value.trim();
            
            if (!apiKey) {
                showMessage('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (!apiKey.startsWith('sk-ant-')) {
                showMessage('ì˜¬ë°”ë¥¸ Anthropic API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (sk-ant-ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤)', 'error');
                return;
            }
            
            showMessage('API í‚¤ë¥¼ ì„¤ì •í•˜ëŠ” ì¤‘...', 'info');
            
            try {
                const response = await fetch('/set-api-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({api_key: apiKey})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('âœ… API í‚¤ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì‹¤ì œ MCPë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('anthropicApiKey').value = '';
                    
                    // MCP ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => {
                        checkMcpStatus();
                    }, 1000);
                } else {
                    showMessage('âŒ ' + result.message, 'error');
                }
                
            } catch (error) {
                showMessage('API í‚¤ ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }
        
        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // === MCP ë¡œê·¸ ê´€ë ¨ í•¨ìˆ˜ë“¤ ===
        
        let autoRefreshInterval = null;
        
        // MCP ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadMcpLogs() {
            try {
                const response = await fetch('/mcp-logs?limit=50');
                const data = await response.json();
                
                if (data.success) {
                    displayMcpLogs(data.logs);
                } else {
                    showMessage('ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                showMessage('ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // MCP ë¡œê·¸ í‘œì‹œ
        function displayMcpLogs(logs) {
            const container = document.getElementById('mcpLogsContainer');
            
            if (!logs || logs.length === 0) {
                container.innerHTML = '<div class="no-logs">ğŸ“­ ì•„ì§ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            const logsHTML = logs.map(log => {
                const levelClass = `log-${log.level}`;
                const icon = getLogIcon(log.level);
                const duration = log.duration_ms ? ` (${log.duration_ms.toFixed(1)}ms)` : '';
                
                let detailsHTML = '';
                if (log.details) {
                    if (log.details.command) {
                        detailsHTML += `<div class="log-detail">ğŸ“ ëª…ë ¹: ${escapeHtml(log.details.command)}</div>`;
                    }
                    if (log.details.author_names) {
                        detailsHTML += `<div class="log-detail">ğŸ‘¥ ì‘ì„±ì: ${log.details.author_names.join(', ')}</div>`;
                    }
                    if (log.details.chart_type) {
                        detailsHTML += `<div class="log-detail">ğŸ“Š ì°¨íŠ¸: ${log.details.chart_type}</div>`;
                    }
                    if (log.details.method) {
                        detailsHTML += `<div class="log-detail">ğŸ”§ ë°©ì‹: ${log.details.method}</div>`;
                    }
                    if (log.details.error) {
                        detailsHTML += `<div class="log-detail log-error">âŒ ì˜¤ë¥˜: ${escapeHtml(log.details.error)}</div>`;
                    }
                }
                
                return `
                    <div class="log-entry ${levelClass}">
                        <div class="log-header">
                            <span class="log-icon">${icon}</span>
                            <span class="log-timestamp">${log.timestamp}</span>
                            <span class="log-category">${log.category.toUpperCase()}</span>
                            <span class="log-message">${escapeHtml(log.message)}${duration}</span>
                        </div>
                        ${detailsHTML ? `<div class="log-details">${detailsHTML}</div>` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = logsHTML;
            
            // ìµœì‹  ë¡œê·¸ë¡œ ìŠ¤í¬ë¡¤
            container.scrollTop = container.scrollHeight;
        }
        
        // ë¡œê·¸ ë ˆë²¨ì— ë”°ë¥¸ ì•„ì´ì½˜ ë°˜í™˜
        function getLogIcon(level) {
            const icons = {
                'info': 'â„¹ï¸',
                'success': 'âœ…',
                'warning': 'âš ï¸',
                'error': 'âŒ',
                'debug': 'ğŸ”'
            };
            return icons[level] || 'ğŸ“';
        }
        
        // MCP ë¡œê·¸ ì´ˆê¸°í™”
        async function clearMcpLogs() {
            if (!confirm('ì •ë§ ëª¨ë“  ë¡œê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch('/clear-mcp-logs', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await loadMcpLogs(); // ìƒˆë¡œê³ ì¹¨
                } else {
                    showMessage('ë¡œê·¸ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('ë¡œê·¸ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                showMessage('ë¡œê·¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ìë™ ìƒˆë¡œê³ ì¹¨ í† ê¸€
        function toggleAutoRefresh() {
            const checkbox = document.getElementById('autoRefreshLogs');
            
            if (checkbox.checked) {
                // ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘ (5ì´ˆë§ˆë‹¤)
                autoRefreshInterval = setInterval(loadMcpLogs, 5000);
                showMessage('ìë™ ìƒˆë¡œê³ ì¹¨ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. (5ì´ˆë§ˆë‹¤)', 'info');
            } else {
                // ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                showMessage('ìë™ ìƒˆë¡œê³ ì¹¨ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }
        
        // === ê²Œì‹œê¸€ ìˆ˜ì •/ì‚­ì œ ê´€ë ¨ í•¨ìˆ˜ë“¤ ===
        
        let currentEditPostId = null;
        
        // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function openEditModal(postId, title, content, author, numericValue, category) {
            currentEditPostId = postId;
            
            // í¼ í•„ë“œ ì±„ìš°ê¸°
            document.getElementById('editAuthor').value = author;
            document.getElementById('editTitle').value = title;
            document.getElementById('editContent').value = content || '';
            document.getElementById('editNumericValue').value = numericValue || '';
            document.getElementById('editCategory').value = category || '';
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('editModal').style.display = 'block';
        }
        
        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditPostId = null;
        }
        
        // ê²Œì‹œê¸€ ìˆ˜ì •
        async function updatePost(event) {
            event.preventDefault();
            
            if (!currentEditPostId) {
                showMessage('ìˆ˜ì •í•  ê²Œì‹œê¸€ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const updateData = {
                title: document.getElementById('editTitle').value.trim(),
                content: document.getElementById('editContent').value.trim(),
                author: document.getElementById('editAuthor').value.trim()
            };
            
            if (!updateData.title || !updateData.author) {
                showMessage('ì œëª©ê³¼ ì‘ì„±ìëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/posts/${currentEditPostId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    closeEditModal();
                    await loadPosts(); // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    showMessage('ê²Œì‹œê¸€ ìˆ˜ì • ì‹¤íŒ¨: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ìˆ˜ì • ì˜¤ë¥˜:', error);
                showMessage('ê²Œì‹œê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ê²Œì‹œê¸€ ì‚­ì œ
        async function deletePost(postId, title) {
            if (!confirm(`'${title}' ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/posts/${postId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await loadPosts(); // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    showMessage('ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ì‚­ì œ ì˜¤ë¥˜:', error);
                showMessage('ê²Œì‹œê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ìˆ˜ì • í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('editForm').addEventListener('submit', updatePost);
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeEditModal();
            }
        }
        
        // === MCP ê²Œì‹œê¸€ ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ===
        
        // ê²Œì‹œê¸€ ê´€ë¦¬ ëª…ë ¹ ì‹¤í–‰
        async function executePostCommand() {
            const command = document.getElementById('postCommand').value.trim();
            
            if (!command) {
                showMessage('ëª…ë ¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            showMessage('ğŸ¤– MCPê°€ ëª…ë ¹ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...', 'info');
            document.getElementById('postResult').style.display = 'none';
            
            try {
                const response = await fetch('/manage-post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ command: command })
                });
                
                const result = await response.json();
                
                // ê²°ê³¼ í‘œì‹œ
                displayPostResult(result);
                
                // ì„±ê³µ ì‹œ ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (create, update, delete ì•¡ì…˜ì˜ ê²½ìš°)
                if (result.success && result.action && ['create', 'update', 'delete'].includes(result.action)) {
                    await loadPosts();
                }
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('postCommand').value = '';
                
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ê´€ë¦¬ ì˜¤ë¥˜:', error);
                showMessage('ê²Œì‹œê¸€ ê´€ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                document.getElementById('postResult').style.display = 'none';
            }
        }
        
        // ê²Œì‹œê¸€ ê´€ë¦¬ ê²°ê³¼ í‘œì‹œ
        function displayPostResult(result) {
            const resultContainer = document.getElementById('postResult');
            const resultContent = document.getElementById('postResultContent');
            
            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            let html = `
                <div class="result-summary ${result.success ? 'success' : 'error'}">
                    <div class="result-status">
                        <span class="status-icon">${result.success ? 'âœ…' : 'âŒ'}</span>
                        <span class="status-message">${escapeHtml(result.message)}</span>
                    </div>
            `;
            
            // íŒŒì‹± ê²°ê³¼ í‘œì‹œ
            if (result.parsed_result) {
                const parsed = result.parsed_result;
                html += `
                    <div class="parse-info">
                        <h4>ğŸ§  AI íŒŒì‹± ì •ë³´</h4>
                        <div class="parse-details">
                            <span class="parse-item"><strong>ì•¡ì…˜:</strong> ${escapeHtml(parsed.action || 'N/A')}</span>
                            <span class="parse-item"><strong>ì‹ ë¢°ë„:</strong> ${(parsed.confidence * 100).toFixed(0)}%</span>
                            <span class="parse-item"><strong>ë°©ì‹:</strong> ${escapeHtml(parsed.method || 'N/A')}</span>
                        </div>
                        <div class="parse-explanation">
                            <strong>ì„¤ëª…:</strong> ${escapeHtml(parsed.explanation || '')}
                        </div>
                    </div>
                `;
            }
            
            html += `</div>`;
            
            // ì•¡ì…˜ë³„ ì„¸ë¶€ ì •ë³´ í‘œì‹œ
            if (result.success && result.action) {
                html += `<div class="action-details">`;
                
                switch (result.action) {
                    case 'create':
                        if (result.post) {
                            html += `
                                <h4>ğŸ“ ìƒì„±ëœ ê²Œì‹œê¸€</h4>
                                <div class="created-post">
                                    <div class="post-info">
                                        <strong>ID:</strong> ${result.post.id}<br>
                                        <strong>ì œëª©:</strong> ${escapeHtml(result.post.title)}<br>
                                        <strong>ì‘ì„±ì:</strong> ${escapeHtml(result.post.author)}<br>
                                        <strong>ë‚´ìš©:</strong> ${escapeHtml(result.post.content || 'ë‚´ìš© ì—†ìŒ')}<br>
                                        ${result.post.numeric_value ? `<strong>ìˆ˜ì¹˜ê°’:</strong> ${result.post.numeric_value}<br>` : ''}
                                        ${result.post.category ? `<strong>ì¹´í…Œê³ ë¦¬:</strong> ${escapeHtml(result.post.category)}<br>` : ''}
                                    </div>
                                </div>
                            `;
                        }
                        break;
                        
                    case 'update':
                        html += `
                            <h4>âœï¸ ìˆ˜ì • ì •ë³´</h4>
                            <div class="update-info">
                                <strong>ê²Œì‹œê¸€ ID:</strong> ${result.post_id}<br>
                                <strong>ìˆ˜ì •ëœ í•„ë“œ:</strong> ${escapeHtml(result.field)}<br>
                                <strong>ìƒˆë¡œìš´ ê°’:</strong> ${escapeHtml(result.new_value)}
                            </div>
                        `;
                        break;
                        
                    case 'delete':
                        if (result.deleted_count !== undefined) {
                            html += `
                                <h4>ğŸ—‘ï¸ ì‚­ì œ ì •ë³´</h4>
                                <div class="delete-info">
                                    <strong>ì‘ì„±ì:</strong> ${escapeHtml(result.filter_author)}<br>
                                    <strong>ì‚­ì œëœ ê²Œì‹œê¸€ ìˆ˜:</strong> ${result.deleted_count}ê°œ
                                </div>
                            `;
                        } else if (result.post_id) {
                            html += `
                                <h4>ğŸ—‘ï¸ ì‚­ì œ ì •ë³´</h4>
                                <div class="delete-info">
                                    <strong>ì‚­ì œëœ ê²Œì‹œê¸€ ID:</strong> ${result.post_id}
                                </div>
                            `;
                        }
                        break;
                        
                    case 'list':
                        html += `
                            <h4>ğŸ“‹ ì¡°íšŒ ì •ë³´</h4>
                            <div class="list-info">
                                <strong>ì°¾ì€ ê²Œì‹œê¸€ ìˆ˜:</strong> ${result.count}ê°œ
                                ${result.filter_author ? `<br><strong>ì‘ì„±ì:</strong> ${escapeHtml(result.filter_author)}` : ''}
                            </div>
                        `;
                        
                        if (result.posts && result.posts.length > 0) {
                            html += `
                                <div class="posts-preview">
                                    <h5>ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡ (ìµœê·¼ 5ê°œ)</h5>
                                    <div class="posts-list">
                            `;
                            
                            // ìµœê·¼ 5ê°œë§Œ í‘œì‹œ
                            const postsToShow = result.posts.slice(0, 5);
                            postsToShow.forEach(post => {
                                html += `
                                    <div class="post-preview">
                                        <strong>[${post.id}] ${escapeHtml(post.title)}</strong> - ${escapeHtml(post.author)}
                                        <br><small>${escapeHtml(post.content ? post.content.substring(0, 100) : 'ë‚´ìš© ì—†ìŒ')}${post.content && post.content.length > 100 ? '...' : ''}</small>
                                    </div>
                                `;
                            });
                            
                            html += `
                                    </div>
                                </div>
                            `;
                            
                            if (result.posts.length > 5) {
                                html += `<p><small>... ì™¸ ${result.posts.length - 5}ê°œ ë”</small></p>`;
                            }
                        }
                        break;
                }
                
                html += `</div>`;
            }
            
            resultContent.innerHTML = html;
            resultContainer.style.display = 'block';
            
            // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Enter í‚¤ë¡œ ê²Œì‹œê¸€ ëª…ë ¹ ì‹¤í–‰
        document.getElementById('postCommand').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executePostCommand();
            }
        });
    </script>
</body>
</html>